<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>日志 on 趣味互联网</title>
    <link>http://:1313/tmp/tags/%E6%97%A5%E5%BF%97/</link>
    <description>Recent content in 日志 on 趣味互联网</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Fri, 22 Nov 2013 14:35:53 +0000</lastBuildDate>
    <atom:link href="http://:1313/tmp/tags/%E6%97%A5%E5%BF%97/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>一个简单的日志监控脚本</title>
      <link>http://:1313/tmp/2013/11/%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%97%A5%E5%BF%97%E7%9B%91%E6%8E%A7%E8%84%9A%E6%9C%AC/</link>
      <pubDate>Fri, 22 Nov 2013 14:35:53 +0000</pubDate>
      
      <guid>http://:1313/tmp/2013/11/%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%97%A5%E5%BF%97%E7%9B%91%E6%8E%A7%E8%84%9A%E6%9C%AC/</guid>
      <description>&lt;p&gt;用最小的成本实现的一个日志监控程序，示例如下:&lt;/p&gt;

&lt;div class=&#34;codecolorer-container bash blackboard&#34; style=&#34;overflow:auto;white-space:nowrap;&#34;&gt;
  &lt;table cellspacing=&#34;0&#34; cellpadding=&#34;0&#34;&gt;
    &lt;tr&gt;
      &lt;td class=&#34;line-numbers&#34;&gt;
        &lt;div&gt;
          1&lt;br /&gt;2&lt;br /&gt;3&lt;br /&gt;4&lt;br /&gt;5&lt;br /&gt;6&lt;br /&gt;7&lt;br /&gt;8&lt;br /&gt;9&lt;br /&gt;10&lt;br /&gt;11&lt;br /&gt;12&lt;br /&gt;13&lt;br /&gt;14&lt;br /&gt;
        &lt;/div&gt;
      &lt;/td&gt;
      
      &lt;td&gt;
        &lt;div class=&#34;bash codecolorer&#34;&gt;
          &lt;span class=&#34;co0&#34;&gt;#!/bin/sh&lt;/span&gt;&lt;br /&gt; &lt;span class=&#34;kw2&#34;&gt;sleep&lt;/span&gt; 5m&lt;br /&gt; &lt;span class=&#34;re2&#34;&gt;log&lt;/span&gt;=&lt;span class=&#34;sy0&#34;&gt;/&lt;/span&gt;var&lt;span class=&#34;sy0&#34;&gt;/&lt;/span&gt;log&lt;span class=&#34;sy0&#34;&gt;/&lt;/span&gt;php5.log&lt;br /&gt; &lt;span class=&#34;kw2&#34;&gt;tail&lt;/span&gt; &lt;span class=&#34;re5&#34;&gt;-Fn0&lt;/span&gt; &lt;span class=&#34;re1&#34;&gt;$log&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;|&lt;/span&gt; \&lt;br /&gt; &lt;span class=&#34;kw1&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;kw2&#34;&gt;read&lt;/span&gt; line; &lt;span class=&#34;kw1&#34;&gt;do&lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span class=&#34;kw3&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;re1&#34;&gt;$line&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;kw2&#34;&gt;grep&lt;/span&gt; &lt;span class=&#34;st_h&#34;&gt;&#39;Fatal error&#39;&lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span class=&#34;kw1&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#91;&lt;/span&gt; &lt;span class=&#34;re4&#34;&gt;$?&lt;/span&gt; = &lt;span class=&#34;nu0&#34;&gt;&lt;/span&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#93;&lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span class=&#34;kw1&#34;&gt;then&lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span class=&#34;re2&#34;&gt;pids&lt;/span&gt;=$&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;kw2&#34;&gt;ps&lt;/span&gt; aux &lt;span class=&#34;sy0&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;kw2&#34;&gt;grep&lt;/span&gt; &lt;span class=&#34;re4&#34;&gt;$0&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;kw2&#34;&gt;grep&lt;/span&gt; &lt;span class=&#34;re5&#34;&gt;-v&lt;/span&gt; &lt;span class=&#34;st_h&#34;&gt;&#39;grep&#39;&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;kw2&#34;&gt;awk&lt;/span&gt; &lt;span class=&#34;st_h&#34;&gt;&#39;{print $2}&#39;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; php mail_error.php &lt;span class=&#34;st_h&#34;&gt;&#39;PHP Fatal error&#39;&lt;/span&gt; &lt;span class=&#34;st0&#34;&gt;&#34;&lt;span class=&#34;es2&#34;&gt;$line&lt;/span&gt;&#34;&lt;/span&gt; &lt;span class=&#34;co0&#34;&gt;# do what you want to do &lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span class=&#34;kw2&#34;&gt;sh&lt;/span&gt; &lt;span class=&#34;re4&#34;&gt;$0&lt;/span&gt; &lt;span class=&#34;st0&#34;&gt;&#34;$@&#34;&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;&amp;&lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span class=&#34;br0&#34;&gt;&amp;#91;&lt;/span&gt; &lt;span class=&#34;st0&#34;&gt;&#34;&lt;span class=&#34;es2&#34;&gt;$pids&lt;/span&gt;&#34;&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;!&lt;/span&gt;= &lt;span class=&#34;st0&#34;&gt;&#34;&#34;&lt;/span&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#93;&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;&amp;&amp;&lt;/span&gt; &lt;span class=&#34;kw2&#34;&gt;kill&lt;/span&gt; &lt;span class=&#34;re5&#34;&gt;-9&lt;/span&gt; &lt;span class=&#34;re1&#34;&gt;$pids&lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span class=&#34;kw1&#34;&gt;fi&lt;/span&gt;&lt;br /&gt; &lt;span class=&#34;kw1&#34;&gt;done&lt;/span&gt;
        &lt;/div&gt;
      &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;代码副本：&lt;a href=&#34;https://gist.github.com/tomheng/7600651&#34;&gt;https://gist.github.com/tomheng/7600651&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;程序会在找到第一个错误的时候后会重新启动自己（先kill 掉自己，然后再启动），此外程序开始的时候会有一个休眠时间。这样做防止同一个错误被不断的报错，特别是访问量大的时候可以会造成问题（如果有报警的话，也会造成干扰）。当然这样同时也产生了一个负面问题，因为有休眠时间，所以有可能会漏掉一部分错误日志，不过这个应该影响不大。&lt;/p&gt;

&lt;p&gt;发邮件的话可以用&lt;a href=&#34;https://github.com/PHPMailer/PHPMailer&#34;&gt;PHPMailer&lt;/a&gt;,简单实用，特别是对那些没有安装软件权限的主机。&lt;/p&gt;

&lt;p&gt;顺祝周末愉快，亲～&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>