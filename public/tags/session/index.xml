<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Session on 趣味互联网</title>
    <link>http://:1313/tmp/tags/session/</link>
    <description>Recent content in Session on 趣味互联网</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Mon, 28 Nov 2011 11:16:34 +0000</lastBuildDate>
    <atom:link href="http://:1313/tmp/tags/session/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>【转载】浅谈PHP中的Session机制</title>
      <link>http://:1313/tmp/2011/11/%E8%BD%AC%E8%BD%BD%E6%B5%85%E8%B0%88php%E4%B8%AD%E7%9A%84session%E6%9C%BA%E5%88%B6/</link>
      <pubDate>Mon, 28 Nov 2011 11:16:34 +0000</pubDate>
      
      <guid>http://:1313/tmp/2011/11/%E8%BD%AC%E8%BD%BD%E6%B5%85%E8%B0%88php%E4%B8%AD%E7%9A%84session%E6%9C%BA%E5%88%B6/</guid>
      <description>&lt;p&gt;做web开发，必然会涉及到Session，这是由于http协议本身是无状态的（每次响应都是独立的，彼此间没有联系），所以如果需要在页面跳转间保持某个用户的身份，就要在每次连接时告诉服务器端你的唯一标示号，即Session ID。这样，服务器端便可通过Session ID得到所需的数据。&lt;/p&gt;

&lt;p&gt;在PHP中，Session是通过$_SESSION这个全局变量来set/get的，不过在使用之前要先初始化。初始化是通过session_start函数（如果php.ini中将session.auto_start设为1，则会自动初始化），之后PHP会为request自动生成一个唯一随机数作为Session ID，生成算法默认提供了MD5 (128 bits) 和SHA-1 (160 bits)，由php.ini中session.hash_function设定。其实也可以自定义，比如在随机数基础上将来访者的IP地址也加入到算法中，像CodeIgniter1.7.2中代码：&lt;/p&gt;

&lt;div class=&#34;codecolorer-container php blackboard&#34; style=&#34;overflow:auto;white-space:nowrap;&#34;&gt;
  &lt;table cellspacing=&#34;0&#34; cellpadding=&#34;0&#34;&gt;
    &lt;tr&gt;
      &lt;td class=&#34;line-numbers&#34;&gt;
        &lt;div&gt;
          1&lt;br /&gt;2&lt;br /&gt;3&lt;br /&gt;4&lt;br /&gt;5&lt;br /&gt;6&lt;br /&gt;7&lt;br /&gt;8&lt;br /&gt;
        &lt;/div&gt;
      &lt;/td&gt;
      
      &lt;td&gt;
        &lt;div class=&#34;php codecolorer&#34;&gt;
          &lt;span class=&#34;re0&#34;&gt;$sessid&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;st_h&#34;&gt;&#39;&#39;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt;&lt;br /&gt; &lt;span class=&#34;kw1&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;a href=&#34;http://www.php.net/strlen&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;strlen&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$sessid&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;&lt;&lt;/span&gt; &lt;span class=&#34;nu0&#34;&gt;32&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;br /&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &lt;span class=&#34;re0&#34;&gt;$sessid&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;.=&lt;/span&gt; &lt;a href=&#34;http://www.php.net/mt_rand&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;mt_rand&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;nu0&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt; &lt;a href=&#34;http://www.php.net/mt_getrandmax&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;mt_getrandmax&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt;&lt;br /&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br /&gt; &lt;span class=&#34;co1&#34;&gt;// To make the session ID even more secure we&#39;ll combine it with the user&#39;s IP&lt;/span&gt;&lt;br /&gt; &lt;span class=&#34;re0&#34;&gt;$sessid&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;.=&lt;/span&gt; &lt;span class=&#34;re0&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;-&gt;&lt;/span&gt;&lt;span class=&#34;me1&#34;&gt;CI&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;-&gt;&lt;/span&gt;&lt;span class=&#34;me1&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;-&gt;&lt;/span&gt;&lt;span class=&#34;me1&#34;&gt;ip_address&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt;&lt;br /&gt; &lt;span class=&#34;re0&#34;&gt;$sessid&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;=&lt;/span&gt; &lt;a href=&#34;http://www.php.net/md5&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;md5&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;a href=&#34;http://www.php.net/uniqid&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;uniqid&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$sessid&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kw4&#34;&gt;TRUE&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;
        &lt;/div&gt;
      &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;生成的ID存放在服务器的某一目录下，这由php.ini中session.save_path配置。如果你选择默认的文件式session存储，那么可能会遇到大量session文件导致IO性能下降，这个问题可以通过调节save_path来优化，具体请看&lt;a href=&#34;http://apps.hi.baidu.com/share/detail/27379034&#34;&gt;大量php session临时文件带来的服务器效率问题&lt;/a&gt;。如果要在多个服务器中同步session id，你可以将其存放在数据库或共享缓存中。这需要你自定义一系列Session的读写方法，并在调用session_start函数前先设定好，以下面代码为例(来自php document中的一段示例代码)：&lt;/p&gt;

&lt;div class=&#34;codecolorer-container sql blackboard&#34; style=&#34;overflow:auto;white-space:nowrap;&#34;&gt;
  &lt;table cellspacing=&#34;0&#34; cellpadding=&#34;0&#34;&gt;
    &lt;tr&gt;
      &lt;td class=&#34;line-numbers&#34;&gt;
        &lt;div&gt;
          1&lt;br /&gt;2&lt;br /&gt;3&lt;br /&gt;4&lt;br /&gt;5&lt;br /&gt;6&lt;br /&gt;
        &lt;/div&gt;
      &lt;/td&gt;
      
      &lt;td&gt;
        &lt;div class=&#34;sql codecolorer&#34;&gt;
          &lt;span class=&#34;kw1&#34;&gt;CREATE&lt;/span&gt; &lt;span class=&#34;kw1&#34;&gt;TABLE&lt;/span&gt; &lt;span class=&#34;st0&#34;&gt;`ws_sessions`&lt;/span&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &lt;span class=&#34;st0&#34;&gt;`session_id`&lt;/span&gt; &lt;span class=&#34;kw1&#34;&gt;VARCHAR&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;nu0&#34;&gt;255&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; &lt;span class=&#34;kw1&#34;&gt;BINARY&lt;/span&gt; &lt;span class=&#34;kw1&#34;&gt;NOT&lt;/span&gt; &lt;span class=&#34;kw1&#34;&gt;NULL&lt;/span&gt; &lt;span class=&#34;kw1&#34;&gt;DEFAULT&lt;/span&gt; &lt;span class=&#34;st0&#34;&gt;&#39;&#39;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &lt;span class=&#34;st0&#34;&gt;`session_expires`&lt;/span&gt; &lt;span class=&#34;kw1&#34;&gt;INT&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;nu0&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; &lt;span class=&#34;kw1&#34;&gt;UNSIGNED&lt;/span&gt; &lt;span class=&#34;kw1&#34;&gt;NOT&lt;/span&gt; &lt;span class=&#34;kw1&#34;&gt;NULL&lt;/span&gt; &lt;span class=&#34;kw1&#34;&gt;DEFAULT&lt;/span&gt; &lt;span class=&#34;st0&#34;&gt;&#39;0&#39;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &lt;span class=&#34;st0&#34;&gt;`session_data`&lt;/span&gt; text&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &lt;span class=&#34;kw1&#34;&gt;PRIMARY&lt;/span&gt; &lt;span class=&#34;kw1&#34;&gt;KEY&lt;/span&gt; &amp;nbsp;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st0&#34;&gt;`session_id`&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; &lt;br /&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; &lt;span class=&#34;kw1&#34;&gt;TYPE&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;=&lt;/span&gt;InnoDB;
        &lt;/div&gt;
      &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/table&gt;
&lt;/div&gt;

&lt;div class=&#34;codecolorer-container php blackboard&#34; style=&#34;overflow:auto;white-space:nowrap;&#34;&gt;
  &lt;table cellspacing=&#34;0&#34; cellpadding=&#34;0&#34;&gt;
    &lt;tr&gt;
      &lt;td class=&#34;line-numbers&#34;&gt;
        &lt;div&gt;
          1&lt;br /&gt;2&lt;br /&gt;3&lt;br /&gt;4&lt;br /&gt;5&lt;br /&gt;6&lt;br /&gt;7&lt;br /&gt;8&lt;br /&gt;9&lt;br /&gt;10&lt;br /&gt;11&lt;br /&gt;12&lt;br /&gt;13&lt;br /&gt;14&lt;br /&gt;15&lt;br /&gt;16&lt;br /&gt;17&lt;br /&gt;18&lt;br /&gt;19&lt;br /&gt;20&lt;br /&gt;21&lt;br /&gt;22&lt;br /&gt;23&lt;br /&gt;24&lt;br /&gt;25&lt;br /&gt;26&lt;br /&gt;27&lt;br /&gt;28&lt;br /&gt;29&lt;br /&gt;30&lt;br /&gt;31&lt;br /&gt;32&lt;br /&gt;33&lt;br /&gt;34&lt;br /&gt;35&lt;br /&gt;36&lt;br /&gt;37&lt;br /&gt;38&lt;br /&gt;39&lt;br /&gt;40&lt;br /&gt;41&lt;br /&gt;42&lt;br /&gt;43&lt;br /&gt;44&lt;br /&gt;45&lt;br /&gt;46&lt;br /&gt;47&lt;br /&gt;48&lt;br /&gt;49&lt;br /&gt;50&lt;br /&gt;51&lt;br /&gt;52&lt;br /&gt;53&lt;br /&gt;54&lt;br /&gt;55&lt;br /&gt;56&lt;br /&gt;57&lt;br /&gt;58&lt;br /&gt;59&lt;br /&gt;60&lt;br /&gt;61&lt;br /&gt;62&lt;br /&gt;63&lt;br /&gt;64&lt;br /&gt;65&lt;br /&gt;66&lt;br /&gt;67&lt;br /&gt;68&lt;br /&gt;69&lt;br /&gt;70&lt;br /&gt;71&lt;br /&gt;72&lt;br /&gt;73&lt;br /&gt;74&lt;br /&gt;75&lt;br /&gt;76&lt;br /&gt;77&lt;br /&gt;78&lt;br /&gt;79&lt;br /&gt;80&lt;br /&gt;81&lt;br /&gt;82&lt;br /&gt;83&lt;br /&gt;84&lt;br /&gt;85&lt;br /&gt;86&lt;br /&gt;87&lt;br /&gt;88&lt;br /&gt;89&lt;br /&gt;90&lt;br /&gt;91&lt;br /&gt;92&lt;br /&gt;93&lt;br /&gt;94&lt;br /&gt;
        &lt;/div&gt;
      &lt;/td&gt;
      
      &lt;td&gt;
        &lt;div class=&#34;php codecolorer&#34;&gt;
          &lt;span class=&#34;kw2&#34;&gt;&lt;?php&lt;/span&gt; &lt;br /&gt; &lt;span class=&#34;kw2&#34;&gt;class&lt;/span&gt; session &lt;span class=&#34;br0&#34;&gt;&amp;#123;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;co1&#34;&gt;// session-lifetime &lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw2&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;re0&#34;&gt;$lifeTime&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;co1&#34;&gt;// mysql-handle &lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw2&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;re0&#34;&gt;$dbHandle&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw2&#34;&gt;function&lt;/span&gt; open&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$savePath&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;re0&#34;&gt;$sessName&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#123;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;co1&#34;&gt;// get session-lifetime &lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;re0&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;-&gt;&lt;/span&gt;&lt;span class=&#34;me1&#34;&gt;lifeTime&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;=&lt;/span&gt; &lt;a href=&#34;http://www.php.net/get_cfg_var&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;get_cfg_var&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st0&#34;&gt;&#34;session.gc_maxlifetime&#34;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;co1&#34;&gt;// open database-connection &lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;re0&#34;&gt;$dbHandle&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;@&lt;/span&gt;&lt;a href=&#34;http://www.php.net/mysql_connect&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;mysql_connect&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st0&#34;&gt;&#34;server&#34;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;st0&#34;&gt;&#34;user&#34;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;st0&#34;&gt;&#34;password&#34;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;re0&#34;&gt;$dbSel&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;@&lt;/span&gt;&lt;a href=&#34;http://www.php.net/mysql_select_db&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;mysql_select_db&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st0&#34;&gt;&#34;database&#34;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$dbHandle&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;co1&#34;&gt;// return success &lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw1&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$dbHandle&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$dbSel&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw1&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kw4&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;re0&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;-&gt;&lt;/span&gt;&lt;span class=&#34;me1&#34;&gt;dbHandle&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;re0&#34;&gt;$dbHandle&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw1&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kw4&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;br0&#34;&gt;&amp;#125;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw2&#34;&gt;function&lt;/span&gt; close&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#123;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;re0&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;-&gt;&lt;/span&gt;&lt;span class=&#34;me1&#34;&gt;gc&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;a href=&#34;http://www.php.net/ini_get&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;ini_get&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;session.gc_maxlifetime&#39;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;co1&#34;&gt;// close database-connection &lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw1&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;@&lt;/span&gt;&lt;a href=&#34;http://www.php.net/mysql_close&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;mysql_close&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;-&gt;&lt;/span&gt;&lt;span class=&#34;me1&#34;&gt;dbHandle&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;br0&#34;&gt;&amp;#125;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw2&#34;&gt;function&lt;/span&gt; read&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$sessID&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#123;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;co1&#34;&gt;// fetch session-data &lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;re0&#34;&gt;$res&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;=&lt;/span&gt; &lt;a href=&#34;http://www.php.net/mysql_query&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;mysql_query&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st0&#34;&gt;&#34;SELECT session_data AS d FROM ws_sessions &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;WHERE session_id = &#39;&lt;span class=&#34;es4&#34;&gt;$sessID&lt;/span&gt;&#39; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;AND session_expires &gt; &#34;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;.&lt;/span&gt;&lt;a href=&#34;http://www.php.net/time&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;time&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;-&gt;&lt;/span&gt;&lt;span class=&#34;me1&#34;&gt;dbHandle&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;co1&#34;&gt;// return data or an empty string at failure &lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw1&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$row&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;=&lt;/span&gt; &lt;a href=&#34;http://www.php.net/mysql_fetch_assoc&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;mysql_fetch_assoc&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$res&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw1&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;re0&#34;&gt;$row&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#91;&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;d&#39;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#93;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw1&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;st0&#34;&gt;&#34;&#34;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;br0&#34;&gt;&amp;#125;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw2&#34;&gt;function&lt;/span&gt; write&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$sessID&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$sessData&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#123;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;co1&#34;&gt;// new session-expire-time &lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;re0&#34;&gt;$newExp&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;=&lt;/span&gt; &lt;a href=&#34;http://www.php.net/time&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;time&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;re0&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;-&gt;&lt;/span&gt;&lt;span class=&#34;me1&#34;&gt;lifeTime&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;co1&#34;&gt;// is a session with this id in the database? &lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;re0&#34;&gt;$res&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;=&lt;/span&gt; &lt;a href=&#34;http://www.php.net/mysql_query&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;mysql_query&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st0&#34;&gt;&#34;SELECT * FROM ws_sessions &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;WHERE session_id = &#39;&lt;span class=&#34;es4&#34;&gt;$sessID&lt;/span&gt;&#39;&#34;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;-&gt;&lt;/span&gt;&lt;span class=&#34;me1&#34;&gt;dbHandle&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;co1&#34;&gt;// if yes, &lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw1&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;a href=&#34;http://www.php.net/mysql_num_rows&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;mysql_num_rows&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$res&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#123;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;co1&#34;&gt;// ...update session-data &lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;a href=&#34;http://www.php.net/mysql_query&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;mysql_query&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st0&#34;&gt;&#34;UPDATE ws_sessions &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;SET session_expires = &#39;&lt;span class=&#34;es4&#34;&gt;$newExp&lt;/span&gt;&#39;, &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;session_data = &#39;&lt;span class=&#34;es4&#34;&gt;$sessData&lt;/span&gt;&#39; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;WHERE session_id = &#39;&lt;span class=&#34;es4&#34;&gt;$sessID&lt;/span&gt;&#39;&#34;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;-&gt;&lt;/span&gt;&lt;span class=&#34;me1&#34;&gt;dbHandle&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;co1&#34;&gt;// if something happened, return true &lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw1&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;a href=&#34;http://www.php.net/mysql_affected_rows&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;mysql_affected_rows&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;-&gt;&lt;/span&gt;&lt;span class=&#34;me1&#34;&gt;dbHandle&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw1&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kw4&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;br0&#34;&gt;&amp;#125;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;co1&#34;&gt;// if no session-data was found, &lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw1&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#123;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;co1&#34;&gt;// create a new row &lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;a href=&#34;http://www.php.net/mysql_query&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;mysql_query&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st0&#34;&gt;&#34;INSERT INTO ws_sessions ( &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;session_id, &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;session_expires, &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;session_data) &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;VALUES( &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&#39;&lt;span class=&#34;es4&#34;&gt;$sessID&lt;/span&gt;&#39;, &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&#39;&lt;span class=&#34;es4&#34;&gt;$newExp&lt;/span&gt;&#39;, &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&#39;&lt;span class=&#34;es4&#34;&gt;$sessData&lt;/span&gt;&#39;)&#34;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;-&gt;&lt;/span&gt;&lt;span class=&#34;me1&#34;&gt;dbHandle&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;co1&#34;&gt;// if row was created, return true &lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw1&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;a href=&#34;http://www.php.net/mysql_affected_rows&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;mysql_affected_rows&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;-&gt;&lt;/span&gt;&lt;span class=&#34;me1&#34;&gt;dbHandle&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw1&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kw4&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;br0&#34;&gt;&amp;#125;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;co1&#34;&gt;// an unknown error occured &lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw1&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kw4&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;br0&#34;&gt;&amp;#125;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw2&#34;&gt;function&lt;/span&gt; destroy&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$sessID&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#123;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;co1&#34;&gt;// delete session-data &lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;a href=&#34;http://www.php.net/mysql_query&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;mysql_query&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st0&#34;&gt;&#34;DELETE FROM ws_sessions WHERE session_id = &#39;&lt;span class=&#34;es4&#34;&gt;$sessID&lt;/span&gt;&#39;&#34;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;-&gt;&lt;/span&gt;&lt;span class=&#34;me1&#34;&gt;dbHandle&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;co1&#34;&gt;// if session was deleted, return true, &lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw1&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;a href=&#34;http://www.php.net/mysql_affected_rows&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;mysql_affected_rows&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;-&gt;&lt;/span&gt;&lt;span class=&#34;me1&#34;&gt;dbHandle&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw1&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kw4&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;co1&#34;&gt;// ...else return false &lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw1&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kw4&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;br0&#34;&gt;&amp;#125;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw2&#34;&gt;function&lt;/span&gt; gc&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$sessMaxLifeTime&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#123;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;co1&#34;&gt;// delete old sessions &lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;a href=&#34;http://www.php.net/mysql_query&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;mysql_query&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st0&#34;&gt;&#34;DELETE FROM ws_sessions WHERE session_expires &lt; &#34;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;.&lt;/span&gt;&lt;a href=&#34;http://www.php.net/time&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;time&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;-&gt;&lt;/span&gt;&lt;span class=&#34;me1&#34;&gt;dbHandle&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;co1&#34;&gt;// return affected rows &lt;/span&gt;&lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;kw1&#34;&gt;return&lt;/span&gt; &lt;a href=&#34;http://www.php.net/mysql_affected_rows&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;mysql_affected_rows&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;-&gt;&lt;/span&gt;&lt;span class=&#34;me1&#34;&gt;dbHandle&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;br0&#34;&gt;&amp;#125;&lt;/span&gt; &lt;br /&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#125;&lt;/span&gt; &lt;br /&gt; &lt;span class=&#34;re0&#34;&gt;$session&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kw2&#34;&gt;new&lt;/span&gt; session&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &lt;a href=&#34;http://www.php.net/session_set_save_handler&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;session_set_save_handler&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;a href=&#34;http://www.php.net/array&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;&amp;&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$session&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;st0&#34;&gt;&#34;open&#34;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;a href=&#34;http://www.php.net/array&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;&amp;&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$session&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;st0&#34;&gt;&#34;close&#34;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;a href=&#34;http://www.php.net/array&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;&amp;&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$session&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;st0&#34;&gt;&#34;read&#34;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;a href=&#34;http://www.php.net/array&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;&amp;&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$session&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;st0&#34;&gt;&#34;write&#34;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;a href=&#34;http://www.php.net/array&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;&amp;&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$session&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;st0&#34;&gt;&#34;destroy&#34;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt; &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;a href=&#34;http://www.php.net/array&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;&amp;&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$session&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;st0&#34;&gt;&#34;gc&#34;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &lt;a href=&#34;http://www.php.net/session_start&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;session_start&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &lt;span class=&#34;co1&#34;&gt;// etc... &lt;/span&gt;&lt;br /&gt; &lt;span class=&#34;sy1&#34;&gt;?&gt;&lt;/span&gt;
        &lt;/div&gt;
      &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;除了上述方法外还有其他办法可以保持Session的同步，可以参考&lt;a href=&#34;http://www.fuchaoqun.com/2009/02/php-session-confuse/&#34;&gt;PHP SESSION解惑&lt;/a&gt;一文中第四部分“session的同步”。&lt;/p&gt;

&lt;p&gt;下面再谈谈Session ID的传递方式：Cookie和URL传递。&lt;br /&gt;
Cookie是比较常用的方式，在这种模式下，启动Session后服务器会在HTTP Response中自动加上header(‘Set-Cookie: session_name()=session_id(); path=/’)，并在以后的请求中加上这个Cookie。当从该页跳转到的新页面并调用session_start()后，PHP将检查与给定ID相关联的服务器端存贮的session数据，如果没找到，则新建一个数据集。但是有一点，这种传递方式必须在用户浏览器开启Cookie的情况下才可用，如果万一用户关闭了Cookie，那么只好选择另外一种通过URL参数传递Session ID。&lt;br /&gt;
开启URL传递需要在php.ini中设置session.use_trans_sid（文档中提示使用这种方式会有安全风险，因为它显示地将Session ID放在url中，所以除非迫不得已不要选择此方式），并在代码中做如下修改：&lt;/p&gt;

&lt;div class=&#34;codecolorer-container php blackboard&#34; style=&#34;overflow:auto;white-space:nowrap;&#34;&gt;
  &lt;table cellspacing=&#34;0&#34; cellpadding=&#34;0&#34;&gt;
    &lt;tr&gt;
      &lt;td class=&#34;line-numbers&#34;&gt;
        &lt;div&gt;
          1&lt;br /&gt;2&lt;br /&gt;3&lt;br /&gt;4&lt;br /&gt;5&lt;br /&gt;6&lt;br /&gt;
        &lt;/div&gt;
      &lt;/td&gt;
      
      &lt;td&gt;
        &lt;div class=&#34;php codecolorer&#34;&gt;
          &lt;span class=&#34;co1&#34;&gt;// 如果客户端使用cookie,可直接传递session到page2.php&lt;/span&gt;&lt;br /&gt; &lt;br /&gt; &lt;span class=&#34;kw1&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;st_h&#34;&gt;&#39;&lt;br /&gt;&lt;a href=&#34;page2.php&#34;&gt;page 2&lt;/a&gt;&#39;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt;&lt;br /&gt; &amp;nbsp;&lt;br /&gt; &lt;span class=&#34;co1&#34;&gt;// 如果客户端禁用cookie&lt;/span&gt;&lt;br /&gt; &lt;span class=&#34;kw1&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;st_h&#34;&gt;&#39;&lt;br /&gt;&lt;a href=&#34;page2.php?&#39;&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;.&lt;/span&gt; SID &lt;span class=&#34;sy0&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;st_h&#34;&gt;&#39;&#34;&gt;page 2&lt;/a&gt;&#39;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt;
        &lt;/div&gt;
      &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;/*&lt;br /&gt;
默认php5.2.1下,SID只有在cookie被写入的同时才会有值,如果该session&lt;br /&gt;
对应的cookie已经存在,那么SID将为(未定义)空&lt;br /&gt;
*/&lt;br /&gt;
更新2010－12－28：&lt;br /&gt;
如果php使用默认的file方式存储session，还要注意lock问题。因为php会lock住session文件直到这个session关闭，所以如果你的应用中涉及iframe、下载、Comet或者用户在同一个浏览器打开多个tab等等多个并行请求都要操作session时，就可能会遇到由于lock影响用户操作的情况。一个简单的解决办法就是在操作完session时，及时调用session_commit()或session_write_close()来关闭session，从而释放锁。（注意在关闭session后不要再调用任何session相关的函数）&lt;/p&gt;

&lt;p&gt;关于Session的内容还有很多，具体可查看&lt;a href=&#34;http://www.php.net/manual/en/book.session.php&#34;&gt;官方手册&lt;/a&gt;，如果有新的总结会继续更新。&lt;br /&gt;
原文链接：&lt;a href=&#34;http://imdonkey.com/blog/archives/255&#34;&gt;http://imdonkey.com/blog/archives/255&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>