<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>闭包 on 趣味互联网</title>
    <link>http://:1313/tmp/tags/%E9%97%AD%E5%8C%85/</link>
    <description>Recent content in 闭包 on 趣味互联网</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Wed, 07 Dec 2011 06:38:17 +0000</lastBuildDate>
    <atom:link href="http://:1313/tmp/tags/%E9%97%AD%E5%8C%85/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>在什么场景下使用闭包？</title>
      <link>http://:1313/tmp/2011/12/%E5%9C%A8%E4%BB%80%E4%B9%88%E5%9C%BA%E6%99%AF%E4%B8%8B%E4%BD%BF%E7%94%A8%E9%97%AD%E5%8C%85/</link>
      <pubDate>Wed, 07 Dec 2011 06:38:17 +0000</pubDate>
      
      <guid>http://:1313/tmp/2011/12/%E5%9C%A8%E4%BB%80%E4%B9%88%E5%9C%BA%E6%99%AF%E4%B8%8B%E4%BD%BF%E7%94%A8%E9%97%AD%E5%8C%85/</guid>
      <description>&lt;p&gt;在需要把逻辑封装到自己的范围内的情况下，闭包会十分有用。重构旧代码以进行简化并提高可读性就是这样一个例子。查看以下示例，该示例显示了在运行一些 SQL 查询时使用的记录程序。&lt;/p&gt;

&lt;div class=&#34;codecolorer-container php blackboard&#34; style=&#34;overflow:auto;white-space:nowrap;&#34;&gt;
  &lt;table cellspacing=&#34;0&#34; cellpadding=&#34;0&#34;&gt;
    &lt;tr&gt;
      &lt;td class=&#34;line-numbers&#34;&gt;
        &lt;div&gt;
          1&lt;br /&gt;2&lt;br /&gt;3&lt;br /&gt;4&lt;br /&gt;5&lt;br /&gt;6&lt;br /&gt;7&lt;br /&gt;8&lt;br /&gt;9&lt;br /&gt;10&lt;br /&gt;
        &lt;/div&gt;
      &lt;/td&gt;
      
      &lt;td&gt;
        &lt;div class=&#34;php codecolorer&#34;&gt;
          &lt;span class=&#34;co1&#34;&gt;//记录 SQL 查询的代码&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;br /&gt; &lt;span class=&#34;re0&#34;&gt;$db&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;=&lt;/span&gt; &lt;a href=&#34;http://www.php.net/mysqli_connect&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;mysqli_connect&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st0&#34;&gt;&#34;server&#34;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;st0&#34;&gt;&#34;user&#34;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;st0&#34;&gt;&#34;pass&#34;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; Logger&lt;span class=&#34;sy0&#34;&gt;::&lt;/span&gt;&lt;a href=&#34;http://www.php.net/log&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;log&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;debug&#39;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;database&#39;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;Connected to database&#39;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &lt;span class=&#34;re0&#34;&gt;$db&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;-&gt;&lt;/span&gt;&lt;span class=&#34;me1&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;insert into parts (part, description) values (&#39;&lt;/span&gt;Hammer&lt;span class=&#34;st_h&#34;&gt;&#39;,&#39;&lt;/span&gt;Pounds nails&lt;span class=&#34;st_h&#34;&gt;&#39;); &lt;br /&gt; Logger::log(&#39;&lt;/span&gt;debug&lt;span class=&#34;st_h&#34;&gt;&#39;,&#39;&lt;/span&gt;database&lt;span class=&#34;st_h&#34;&gt;&#39;,&#39;&lt;/span&gt;Insert Hammer into to parts table&lt;span class=&#34;st_h&#34;&gt;&#39;); &lt;br /&gt; $db-&gt;query(&#39;&lt;/span&gt;insert into parts &lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;part&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt; description&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; values &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;Drill&#39;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;Puts holes in wood&#39;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt;&lt;br /&gt; Logger&lt;span class=&#34;sy0&#34;&gt;::&lt;/span&gt;&lt;a href=&#34;http://www.php.net/log&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;log&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;debug&#39;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;database&#39;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;Insert Drill into to parts table&#39;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &lt;span class=&#34;re0&#34;&gt;$db&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;-&gt;&lt;/span&gt;&lt;span class=&#34;me1&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;insert into parts (part, description) values (&#39;&lt;/span&gt;Saw&lt;span class=&#34;st_h&#34;&gt;&#39;,&#39;&lt;/span&gt;Cuts wood&lt;span class=&#34;st_h&#34;&gt;&#39;); &lt;br /&gt; Logger::log(&#39;&lt;/span&gt;debug&lt;span class=&#34;st_h&#34;&gt;&#39;,&#39;&lt;/span&gt;database&lt;span class=&#34;st_h&#34;&gt;&#39;,&#39;&lt;/span&gt;Insert Saw into to parts table&lt;span class=&#34;st_h&#34;&gt;&#39;);&lt;/span&gt;
        &lt;/div&gt;
      &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;可以看出执行操作的重复程度。对 Logger::log() 执行的每次调用都有相同的前两个实参。为了解决此问题，我们可以把该方法调用放入闭包并转而针对该闭包执行调用。得到的代码如下所示：&lt;/p&gt;

&lt;div class=&#34;codecolorer-container php blackboard&#34; style=&#34;overflow:auto;white-space:nowrap;&#34;&gt;
  &lt;table cellspacing=&#34;0&#34; cellpadding=&#34;0&#34;&gt;
    &lt;tr&gt;
      &lt;td class=&#34;line-numbers&#34;&gt;
        &lt;div&gt;
          1&lt;br /&gt;2&lt;br /&gt;3&lt;br /&gt;4&lt;br /&gt;5&lt;br /&gt;6&lt;br /&gt;7&lt;br /&gt;8&lt;br /&gt;9&lt;br /&gt;10&lt;br /&gt;11&lt;br /&gt;
        &lt;/div&gt;
      &lt;/td&gt;
      
      &lt;td&gt;
        &lt;div class=&#34;php codecolorer&#34;&gt;
          &lt;span class=&#34;co1&#34;&gt;//记录 SQL 查询的重构代码&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;br /&gt; &lt;span class=&#34;re0&#34;&gt;$logdb&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kw2&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$string&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#123;&lt;/span&gt; Logger&lt;span class=&#34;sy0&#34;&gt;::&lt;/span&gt;&lt;a href=&#34;http://www.php.net/log&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;log&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;debug&#39;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;database&#39;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;re0&#34;&gt;$string&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt;&lt;br /&gt; &lt;span class=&#34;re0&#34;&gt;$db&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;=&lt;/span&gt; &lt;a href=&#34;http://www.php.net/mysqli_connect&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;mysqli_connect&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st0&#34;&gt;&#34;server&#34;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;st0&#34;&gt;&#34;user&#34;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;st0&#34;&gt;&#34;pass&#34;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &lt;span class=&#34;re0&#34;&gt;$logdb&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;Connected to database&#39;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &lt;span class=&#34;re0&#34;&gt;$db&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;-&gt;&lt;/span&gt;&lt;span class=&#34;me1&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;insert into parts (part, description) values (&#39;&lt;/span&gt;Hammer&lt;span class=&#34;st_h&#34;&gt;&#39;,&#39;&lt;/span&gt;Pounds nails&lt;span class=&#34;st_h&#34;&gt;&#39;); &lt;br /&gt; $logdb(&#39;&lt;/span&gt;Insert Hammer into to parts table&lt;span class=&#34;st_h&#34;&gt;&#39;); &lt;br /&gt; $db-&gt;query(&#39;&lt;/span&gt;insert into parts &lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;part&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt; description&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; values &lt;br /&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;Drill&#39;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;Puts holes in wood&#39;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt;&lt;br /&gt; &lt;span class=&#34;re0&#34;&gt;$logdb&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;Insert Drill into to parts table&#39;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;br /&gt; &lt;span class=&#34;re0&#34;&gt;$db&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;-&gt;&lt;/span&gt;&lt;span class=&#34;me1&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;insert into parts (part, description) values (&#39;&lt;/span&gt;Saw&lt;span class=&#34;st_h&#34;&gt;&#39;,&#39;&lt;/span&gt;Cuts wood&lt;span class=&#34;st_h&#34;&gt;&#39;); &lt;br /&gt; $logdb(&#39;&lt;/span&gt;Insert Saw into to parts table&lt;span class=&#34;st_h&#34;&gt;&#39;);&lt;/span&gt;
        &lt;/div&gt;
      &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;整理自：&lt;a href=&#34;http://www.ibm.com/developerworks/cn/opensource/os-php-5.3new2/&#34;&gt;http://www.ibm.com/developerworks/cn/opensource/os-php-5.3new2/&lt;/a&gt;&lt;br /&gt;
PS:原文有些不正确的地方，比方说到PHP 5.3.5都不可以通过闭包中的this指针访问类内的成员变量（当然可以通过其他方法实现），文章大部分内容正确，还是“尽信书不如无书”。&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>