<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Bigpipe on 趣味互联网</title>
    <link>http://:1313/tmp/tags/bigpipe/</link>
    <description>Recent content in Bigpipe on 趣味互联网</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Tue, 28 Jun 2011 14:52:09 +0000</lastBuildDate>
    <atom:link href="http://:1313/tmp/tags/bigpipe/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>【转载】白话BigPipe</title>
      <link>http://:1313/tmp/2011/06/%E8%BD%AC%E8%BD%BD%E7%99%BD%E8%AF%9Dbigpipe/</link>
      <pubDate>Tue, 28 Jun 2011 14:52:09 +0000</pubDate>
      
      <guid>http://:1313/tmp/2011/06/%E8%BD%AC%E8%BD%BD%E7%99%BD%E8%AF%9Dbigpipe/</guid>
      <description>&lt;p&gt;所谓BigPipe，指的是&lt;a href=&#34;http://www.facebook.com/notes/facebook-engineering/bigpipe-pipelining-web-pages-for-high-performance/389414033919&#34; target=&#34;_blank&#34;&gt;Facebook&lt;/a&gt;开发的用来改善客户端响应速度的技术。本质上讲，其实它并不是新事物，原理上等同于Yahoo在&lt;a href=&#34;http://developer.yahoo.com/performance/rules.html&#34; target=&#34;_blank&#34;&gt;Best Practices for Speeding Up Your Web Site&lt;/a&gt;里提出的Flush the Buffer Early，不过BigPipe的实现更灵活，所以有必要了解一二。&lt;/p&gt;

&lt;p&gt;我们平常浏览网页时的体验通常是串行的：浏览器发起请求，服务器收到后渲染页面，在此期间，浏览器除了等待别无选择，演示代码如下：&lt;/p&gt;

&lt;div class=&#34;codecolorer-container php blackboard&#34; style=&#34;overflow:auto;white-space:nowrap;&#34;&gt;
  &lt;table cellspacing=&#34;0&#34; cellpadding=&#34;0&#34;&gt;
    &lt;tr&gt;
      &lt;td class=&#34;line-numbers&#34;&gt;
        &lt;div&gt;
          1&lt;br /&gt;2&lt;br /&gt;3&lt;br /&gt;4&lt;br /&gt;5&lt;br /&gt;6&lt;br /&gt;7&lt;br /&gt;8&lt;br /&gt;9&lt;br /&gt;10&lt;br /&gt;11&lt;br /&gt;12&lt;br /&gt;13&lt;br /&gt;14&lt;br /&gt;15&lt;br /&gt;16&lt;br /&gt;17&lt;br /&gt;18&lt;br /&gt;19&lt;br /&gt;20&lt;br /&gt;21&lt;br /&gt;22&lt;br /&gt;23&lt;br /&gt;24&lt;br /&gt;
        &lt;/div&gt;
      &lt;/td&gt;
      
      &lt;td&gt;
        &lt;div class=&#34;php codecolorer&#34;&gt;
          &lt;span class=&#34;kw2&#34;&gt;&lt;?php&lt;/span&gt;&lt;br /&gt; &lt;a href=&#34;http://www.php.net/sleep&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;sleep&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;nu0&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt;&lt;br /&gt; &lt;span class=&#34;re0&#34;&gt;$header&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;st_h&#34;&gt;&#39;header&#39;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt;&lt;br /&gt; &lt;br /&gt; &lt;a href=&#34;http://www.php.net/sleep&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;sleep&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;nu0&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt;&lt;br /&gt; &lt;span class=&#34;re0&#34;&gt;$content&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;st_h&#34;&gt;&#39;content&#39;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt;&lt;br /&gt; &lt;br /&gt; &lt;a href=&#34;http://www.php.net/sleep&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;sleep&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;nu0&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt;&lt;br /&gt; &lt;span class=&#34;re0&#34;&gt;$footer&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;st_h&#34;&gt;&#39;footer&#39;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt;&lt;br /&gt; &lt;span class=&#34;sy1&#34;&gt;?&gt;&lt;/span&gt;&lt;br /&gt; &lt;html&gt;&lt;br /&gt; &lt;head&gt;&lt;br /&gt; &lt;title&gt;test&lt;/title&gt;&lt;br /&gt; &lt;/head&gt;&lt;br /&gt; &lt;body&gt;&lt;br /&gt; &lt;br /&gt; &lt;div id=&#34;header&#34;&gt;&lt;span class=&#34;kw2&#34;&gt;&lt;?php&lt;/span&gt; &lt;span class=&#34;kw1&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;re0&#34;&gt;$header&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;sy1&#34;&gt;?&gt;&lt;/span&gt;&lt;/div&gt;&lt;br /&gt; &lt;br /&gt; &lt;div id=&#34;content&#34;&gt;&lt;span class=&#34;kw2&#34;&gt;&lt;?php&lt;/span&gt; &lt;span class=&#34;kw1&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;re0&#34;&gt;$content&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;sy1&#34;&gt;?&gt;&lt;/span&gt;&lt;/div&gt;&lt;br /&gt; &lt;br /&gt; &lt;div id=&#34;footer&#34;&gt;&lt;span class=&#34;kw2&#34;&gt;&lt;?php&lt;/span&gt; &lt;span class=&#34;kw1&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;re0&#34;&gt;$footer&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;sy1&#34;&gt;?&gt;&lt;/span&gt;&lt;/div&gt;&lt;br /&gt; &lt;br /&gt; &lt;/body&gt;&lt;br /&gt; &lt;/html&gt;
        &lt;/div&gt;
      &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;注：代码里用sleep模拟服务端耗时的操作。&lt;/p&gt;

&lt;p&gt;如果我们把串行改成并行的方式呢？每当服务器生成新的内容立刻发送给浏览器，浏览器立刻渲染，不必等到接收到全部数据再处理，毫无疑问会提升用户体验，演示代码如下：&lt;/p&gt;

&lt;p&gt;需要说明的是代码仅运行于Apache + Mod PHP环境，旧版本Apache可能需要关闭GZip。&lt;/p&gt;

&lt;div class=&#34;codecolorer-container php blackboard&#34; style=&#34;overflow:auto;white-space:nowrap;&#34;&gt;
  &lt;table cellspacing=&#34;0&#34; cellpadding=&#34;0&#34;&gt;
    &lt;tr&gt;
      &lt;td class=&#34;line-numbers&#34;&gt;
        &lt;div&gt;
          1&lt;br /&gt;2&lt;br /&gt;3&lt;br /&gt;4&lt;br /&gt;5&lt;br /&gt;6&lt;br /&gt;7&lt;br /&gt;8&lt;br /&gt;9&lt;br /&gt;10&lt;br /&gt;11&lt;br /&gt;12&lt;br /&gt;13&lt;br /&gt;14&lt;br /&gt;15&lt;br /&gt;16&lt;br /&gt;17&lt;br /&gt;18&lt;br /&gt;19&lt;br /&gt;20&lt;br /&gt;
        &lt;/div&gt;
      &lt;/td&gt;
      
      &lt;td&gt;
        &lt;div class=&#34;php codecolorer&#34;&gt;
          &lt;html&gt;&lt;br /&gt; &lt;head&gt;&lt;br /&gt; &lt;title&gt;test&lt;/title&gt;&lt;br /&gt; &lt;/head&gt;&lt;br /&gt; &lt;body&gt;&lt;br /&gt; &lt;br /&gt; &lt;span class=&#34;kw2&#34;&gt;&lt;?php&lt;/span&gt; &lt;a href=&#34;http://www.php.net/sleep&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;sleep&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;nu0&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;sy1&#34;&gt;?&gt;&lt;/span&gt;&lt;br /&gt; &lt;div id=&#34;header&#34;&gt;&lt;span class=&#34;kw2&#34;&gt;&lt;?php&lt;/span&gt; &lt;span class=&#34;kw1&#34;&gt;echo&lt;/span&gt; &lt;a href=&#34;http://www.php.net/str_pad&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;str_pad&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;header&#39;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nu0&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;sy1&#34;&gt;?&gt;&lt;/span&gt;&lt;/div&gt;&lt;br /&gt; &lt;span class=&#34;kw2&#34;&gt;&lt;?php&lt;/span&gt; &lt;a href=&#34;http://www.php.net/ob_flush&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;ob_flush&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;a href=&#34;http://www.php.net/flush&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;flush&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;sy1&#34;&gt;?&gt;&lt;/span&gt;&lt;br /&gt; &lt;br /&gt; &lt;span class=&#34;kw2&#34;&gt;&lt;?php&lt;/span&gt; &lt;a href=&#34;http://www.php.net/sleep&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;sleep&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;nu0&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;sy1&#34;&gt;?&gt;&lt;/span&gt;&lt;br /&gt; &lt;div id=&#34;content&#34;&gt;&lt;span class=&#34;kw2&#34;&gt;&lt;?php&lt;/span&gt; &lt;span class=&#34;kw1&#34;&gt;echo&lt;/span&gt; &lt;a href=&#34;http://www.php.net/str_pad&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;str_pad&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;content&#39;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nu0&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;sy1&#34;&gt;?&gt;&lt;/span&gt;&lt;/div&gt;&lt;br /&gt; &lt;span class=&#34;kw2&#34;&gt;&lt;?php&lt;/span&gt; &lt;a href=&#34;http://www.php.net/ob_flush&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;ob_flush&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;a href=&#34;http://www.php.net/flush&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;flush&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;sy1&#34;&gt;?&gt;&lt;/span&gt;&lt;br /&gt; &lt;br /&gt; &lt;span class=&#34;kw2&#34;&gt;&lt;?php&lt;/span&gt; &lt;a href=&#34;http://www.php.net/sleep&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;sleep&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;nu0&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;sy1&#34;&gt;?&gt;&lt;/span&gt;&lt;br /&gt; &lt;div id=&#34;footer&#34;&gt;&lt;span class=&#34;kw2&#34;&gt;&lt;?php&lt;/span&gt; &lt;span class=&#34;kw1&#34;&gt;echo&lt;/span&gt; &lt;a href=&#34;http://www.php.net/str_pad&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;str_pad&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;footer&#39;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nu0&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;sy1&#34;&gt;?&gt;&lt;/span&gt;&lt;/div&gt;&lt;br /&gt; &lt;span class=&#34;kw2&#34;&gt;&lt;?php&lt;/span&gt; &lt;a href=&#34;http://www.php.net/ob_flush&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;ob_flush&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;a href=&#34;http://www.php.net/flush&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;flush&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;sy1&#34;&gt;?&gt;&lt;/span&gt;&lt;br /&gt; &lt;br /&gt; &lt;/body&gt;&lt;br /&gt; &lt;/html&gt;
        &lt;/div&gt;
      &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;注：某些浏览器必须接收到一定长度的内容才开始渲染，所以代码里用到了str_pad。&lt;/p&gt;

&lt;p&gt;代码里用到ob_flush和flush把页面分块刷新缓存到浏览器，此时如果使用Firebug查看响应头的话，会发现：Transfer-Encoding=chunked，如此一来浏览器就可以实现分块渲染了。&lt;/p&gt;

&lt;p&gt;BigPipe在此基础上更进一步，演示代码如下：&lt;/p&gt;

&lt;div class=&#34;codecolorer-container php blackboard&#34; style=&#34;overflow:auto;white-space:nowrap;&#34;&gt;
  &lt;table cellspacing=&#34;0&#34; cellpadding=&#34;0&#34;&gt;
    &lt;tr&gt;
      &lt;td class=&#34;line-numbers&#34;&gt;
        &lt;div&gt;
          1&lt;br /&gt;2&lt;br /&gt;3&lt;br /&gt;4&lt;br /&gt;5&lt;br /&gt;6&lt;br /&gt;7&lt;br /&gt;8&lt;br /&gt;9&lt;br /&gt;10&lt;br /&gt;11&lt;br /&gt;12&lt;br /&gt;13&lt;br /&gt;14&lt;br /&gt;15&lt;br /&gt;16&lt;br /&gt;17&lt;br /&gt;18&lt;br /&gt;19&lt;br /&gt;20&lt;br /&gt;21&lt;br /&gt;22&lt;br /&gt;23&lt;br /&gt;24&lt;br /&gt;25&lt;br /&gt;26&lt;br /&gt;27&lt;br /&gt;28&lt;br /&gt;29&lt;br /&gt;30&lt;br /&gt;31&lt;br /&gt;32&lt;br /&gt;33&lt;br /&gt;34&lt;br /&gt;
        &lt;/div&gt;
      &lt;/td&gt;
      
      &lt;td&gt;
        &lt;div class=&#34;php codecolorer&#34;&gt;
          &lt;html&gt;&lt;br /&gt; &lt;head&gt;&lt;br /&gt; &lt;title&gt;test&lt;/title&gt;&lt;br /&gt; &lt;/head&gt;&lt;br /&gt; &lt;body&gt;&lt;br /&gt; &lt;br /&gt; &lt;div id=&#34;header&#34;&gt;&lt;/div&gt;&lt;br /&gt; &lt;br /&gt; &lt;div id=&#34;content&#34;&gt;&lt;/div&gt;&lt;br /&gt; &lt;br /&gt; &lt;div id=&#34;footer&#34;&gt;&lt;/div&gt;&lt;br /&gt; &lt;br /&gt; &lt;span class=&#34;kw2&#34;&gt;&lt;?php&lt;/span&gt; &lt;a href=&#34;http://www.php.net/ob_flush&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;ob_flush&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;a href=&#34;http://www.php.net/flush&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;flush&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;sy1&#34;&gt;?&gt;&lt;/span&gt;&lt;br /&gt; &lt;br /&gt; &lt;span class=&#34;kw2&#34;&gt;&lt;?php&lt;/span&gt; &lt;a href=&#34;http://www.php.net/sleep&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;sleep&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;nu0&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;re0&#34;&gt;$header&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;=&lt;/span&gt; &lt;a href=&#34;http://www.php.net/str_pad&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;str_pad&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;header&#39;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nu0&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;sy1&#34;&gt;?&gt;&lt;/span&gt;&lt;br /&gt; &lt;script&gt;&lt;br /&gt; document.getElementById(&#34;header&#34;).innerHTML = &#34;&lt;span class=&#34;kw2&#34;&gt;&lt;?php&lt;/span&gt; &lt;span class=&#34;kw1&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;re0&#34;&gt;$header&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;sy1&#34;&gt;?&gt;&lt;/span&gt;&#34;;&lt;br /&gt; &lt;/script&gt;&lt;br /&gt; &lt;span class=&#34;kw2&#34;&gt;&lt;?php&lt;/span&gt; &lt;a href=&#34;http://www.php.net/ob_flush&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;ob_flush&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;a href=&#34;http://www.php.net/flush&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;flush&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;sy1&#34;&gt;?&gt;&lt;/span&gt;&lt;br /&gt; &lt;br /&gt; &lt;span class=&#34;kw2&#34;&gt;&lt;?php&lt;/span&gt; &lt;a href=&#34;http://www.php.net/sleep&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;sleep&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;nu0&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;re0&#34;&gt;$content&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;=&lt;/span&gt; &lt;a href=&#34;http://www.php.net/str_pad&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;str_pad&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;content&#39;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nu0&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;sy1&#34;&gt;?&gt;&lt;/span&gt;&lt;br /&gt; &lt;script&gt;&lt;br /&gt; document.getElementById(&#34;content&#34;).innerHTML = &#34;&lt;span class=&#34;kw2&#34;&gt;&lt;?php&lt;/span&gt; &lt;span class=&#34;kw1&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;re0&#34;&gt;$content&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;sy1&#34;&gt;?&gt;&lt;/span&gt;&#34;;&lt;br /&gt; &lt;/script&gt;&lt;br /&gt; &lt;span class=&#34;kw2&#34;&gt;&lt;?php&lt;/span&gt; &lt;a href=&#34;http://www.php.net/ob_flush&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;ob_flush&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;a href=&#34;http://www.php.net/flush&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;flush&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;sy1&#34;&gt;?&gt;&lt;/span&gt;&lt;br /&gt; &lt;br /&gt; &lt;span class=&#34;kw2&#34;&gt;&lt;?php&lt;/span&gt; &lt;a href=&#34;http://www.php.net/sleep&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;sleep&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;nu0&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;re0&#34;&gt;$footer&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;=&lt;/span&gt; &lt;a href=&#34;http://www.php.net/str_pad&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;str_pad&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;st_h&#34;&gt;&#39;footer&#39;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nu0&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;sy1&#34;&gt;?&gt;&lt;/span&gt;&lt;br /&gt; &lt;script&gt;&lt;br /&gt; document.getElementById(&#34;footer&#34;).innerHTML = &#34;&lt;span class=&#34;kw2&#34;&gt;&lt;?php&lt;/span&gt; &lt;span class=&#34;kw1&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;re0&#34;&gt;$footer&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;sy1&#34;&gt;?&gt;&lt;/span&gt;&#34;;&lt;br /&gt; &lt;/script&gt;&lt;br /&gt; &lt;span class=&#34;kw2&#34;&gt;&lt;?php&lt;/span&gt; &lt;a href=&#34;http://www.php.net/ob_flush&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;ob_flush&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;a href=&#34;http://www.php.net/flush&#34;&gt;&lt;span class=&#34;kw3&#34;&gt;flush&lt;/span&gt;&lt;/a&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#40;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;sy1&#34;&gt;?&gt;&lt;/span&gt;&lt;br /&gt; &lt;br /&gt; &lt;/body&gt;&lt;br /&gt; &lt;/html&gt;
        &lt;/div&gt;
      &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;使用BigPipe，先刷新布局（Layout），然后按块（header，content，footer）刷新相应的Javascript代码，从而实现页面内容的填充。&lt;/p&gt;

&lt;p&gt;BigPipe之所以使用Javascript渲染页面，是因为这样一来渲染页面的时候，就不会被块的位置束缚住，如果我们的服务器支持多线程，那么就可以同时处理多块内容，哪块先处理好就把哪块刷新到浏览器，即便不支持多线程，服务器也可以按照内容的重要程度分主次先后渲染，不必拘泥于HTML代码的物理顺序。此外还应注意一下BigPipe和Ajax二者的区别，对于一个分成若干个块的页面而言，如果使用Ajax的话，每一块都需要单独发送一个HTTP请求，而如果使用BigPipe的话，不管有多少块，都仅有一个HTTP请求。所以Ajax对服务器造成的压力会是BigPipe的若干倍。&lt;/p&gt;

&lt;p&gt;提醒：BigPipe不利于SEO，应用时可通过User Agent判断请求是人还是搜索引擎，如果是人的话，则应用BigPipe渲染模式，如果是搜索引擎的话，则应用传统渲染模式。&lt;/p&gt;

&lt;p&gt;补充：在Nginx + PHP FastCGI环境运行文中的代码，会发现无效，这是缓存造成的。在Nginx FastCGI环境下，如果数据小于fastcgi_buffers，会缓存到内存中，否则如果数据小于fastcgi_max_temp_file_size，会缓存到硬盘上。因为flush是Apache环境下才有效的函数，不适用于Nginx环境，所以唯一的出路就是想办法关闭缓存，可通过实验发现即便把fastcgi_buffers和fastcgi_max_temp_file_size都禁止了，还是没有用，所以说截至目前为止，Nginx + PHP FastCG无法实现BigPipe，相对可行的方法是通过Apache + Mod PHP实现BigPipe，而Nginx则放在代理服务器的角色上，并使用proxy_buffering关闭代理缓存。&lt;/p&gt;

&lt;p&gt;参考：Facebook网站的Ajax化、缓存和流水线（PDF）。&lt;br /&gt;
来源：&lt;a href=&#34;http://huoding.com/2011/06/26/88&#34;&gt;http://huoding.com/2011/06/26/88&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>